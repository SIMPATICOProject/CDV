<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Service Editor</title>

    <!-- Bootstrap -->
    <link href="vendors/bootstrap/distrib/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- NProgress -->
<!--     <link href="../vendors/nprogress/nprogress.css" rel="stylesheet"> -->

    <!-- iCheck -->
    <link href="vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- Datatables -->
    <link href="vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
    <link href="vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
    <link href="vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
    <link href="vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="css/custom.css" rel="stylesheet">

	<!-- jQuery custom content scroller -->
    <link href="vendors/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css" rel="stylesheet"/>

	<!-- File di configurazione -->
	<script src="js/config.properties.js"></script>

  </head>

  <body class="nav-md footer_fixed">
  
<!-- Large modal -->
    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">

          <div class="modal-header" style="border-bottom: none;padding-bottom: 0 !important;">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span>
            </button>
            <h1 class="modal-title" id="service-title">TITLE</h1>
          </div>
          <div class="modal-body">
            <p id="service-description-content"></p>
          </div>
<!-- SERVICE-LIST SECTION -->
          <div id="service-div-1" class="modal-body" style="border-top: 1px solid #e5e5e5;">
            <h2 id="service-keyword-title">Keywords: </h2>
            <p id="service-keyword-content"></p>
            </br>
            <h2 id="service-puropose-title">Provider: </h2>
            <p id="service-puropose-content"></p>
            </br>
            <h2 id="service-purpose-title">Purpose: </h2>
            <p id="service-purpose-content"></p>
            </br>
            <h2 id="service-link-title">Link: </h2>
            <a style="font-size: 20px;cursor: pointer;color:#0055FF" id="service-link-content"></a>
          </div>
          <div  id="service-div-2" class="keywords-set modal-body" style="border-top: 1px solid #e5e5e5;word-break: break-all;">
          	<h2 id="service-data-title" style="font-style: normal">Data Processed: </h2>
          </div>
<!-- SERVICE-LIST SECTION -->
<!-- PDFIELDS SECTION -->
			<div id="pdf-div" class="modal-body" style="border-top: 1px solid #e5e5e5;">
				<h2 id="pdf-id-title">ID: </h2>
            	<p id="pdf-id-content"></p>
            	</br>
            	<h2 id="pdf-category-title">Category: </h2>
            	<p id="pdf-category-content"></p>
            	</br>
            	<h2 id="pdf-privatePData-title">Private PData: </h2>
            	<p id="pdf-privatePData-content"></p>
            	</br>
            	<h2 id="pdf-semanticType-title">Semantic Type: </h2>
            	<p id="pdf-semanticType-content"></p>
            	</br>
            	<h2 id="pdf-uri-title">URI: </h2>
            	<p id="pdf-uri-content"></p>
            	</br>
			</div>
<!-- PDFIELDS SECTION -->
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
          </div>

        </div>
      </div>
    </div>
<!-- Large modal -->

    <div class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col menu_fixed">
          <div class="left_col scroll-view sidebar-scroll-y">
            <div class="navbar nav_title" style="border: 0;">
              <a href="index.html" class="site_title"><i class="fa fa-users"></i> <span>Service Editor</span></a>
            </div>

            <div class="clearfix"></div>

            <!-- menu profile quick info -->
<!--             <div class="profile clearfix">
              <div class="profile_pic">
                <img src="images/img.jpg" alt="..." class="img-circle profile_img">
              </div>
              <div class="profile_info">
                <span>Welcome,</span>
                <h2>John Doe</h2>
              </div>
            </div> -->
            <!-- /menu profile quick info -->

            <br />

<!-- sidebar menu -->
            <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
              <div class="menu_section">
                <h3>Menu</h3>
                <ul class="nav side-menu">
                  <li><a href="index.html"><i class="fa fa-home"></i> Home </a>
                  </li>
                  <li><a><i class="fa fa-edit"></i> Services <span class="fa fa-chevron-down"></span></a>
                    <ul class="nav child_menu">
                      <li><a href="services-list.html">Available Services</a></li>
                      <li><a href="edit-service.html">Add New Service</a></li>
                    </ul>
                  </li>
                  <li><a><i class="fa fa-key"></i>PDataFields<span class="fa fa-chevron-down"></span></a>
                    <ul class="nav child_menu" id="pdf-section">

                    </ul>
                  </li>
                </ul>
              </div>

            </div>
<!-- /sidebar menu -->

            <!-- /menu footer buttons -->
<!--             <div class="sidebar-footer hidden-small">
              <a data-toggle="tooltip" data-placement="top" title="Settings">
                <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="FullScreen">
                <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="Lock">
                <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="Logout" href="login.html">
                <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
              </a>
            </div> -->
            <!-- /menu footer buttons -->
          </div>
        </div>

<!-- top navigation -->
        <div class="top_nav">
          <div class="nav_menu">
            <nav>
              <div class="nav toggle" style="padding-bottom: 15px !important">
                <a id="menu_toggle"><i class="fa fa-bars"></i></a>
              </div>

              <ul class="nav navbar-nav navbar-right">
                <li class="">
                  <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <img src="images/img.jpg" alt="">John Doe
                    <span class=" fa fa-angle-down"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-usermenu pull-right">
                    <li><a href="javascript:;"> Profile</a></li>
                    <li>
                      <a href="javascript:;">
                        <span class="badge bg-red pull-right">50%</span>
                        <span>Settings</span>
                      </a>
                    </li>
                    <li><a href="javascript:;">Help</a></li>
                    <li><a href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                  </ul>
                </li>

                <!-- <li role="presentation" class="dropdown">
                  <a href="javascript:;" class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false">
                    <i class="fa fa-envelope-o"></i>
                    <span class="badge bg-green">6</span>
                  </a>
                  <ul id="menu1" class="dropdown-menu list-unstyled msg_list" role="menu">
                    <li>
                      <a>
                        <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>John Smith</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Film festivals used to be do-or-die moments for movie makers. They were where...
                        </span>
                      </a>
                    </li>
                    <li>
                      <a>
                        <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>John Smith</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Film festivals used to be do-or-die moments for movie makers. They were where...
                        </span>
                      </a>
                    </li>
                    <li>
                      <a>
                        <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>John Smith</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Film festivals used to be do-or-die moments for movie makers. They were where...
                        </span>
                      </a>
                    </li>
                    <li>
                      <a>
                        <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>John Smith</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Film festivals used to be do-or-die moments for movie makers. They were where...
                        </span>
                      </a>
                    </li>
                    <li>
                      <div class="text-center">
                        <a>
                          <strong>See All Alerts</strong>
                          <i class="fa fa-angle-right"></i>
                        </a>
                      </div>
                    </li>
                  </ul>
                </li> -->
              </ul>
            </nav>
          </div>
        </div>
<!-- /top navigation -->

<!-- page content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h1>Service Editor</h1>
              </div>

<!--               <div class="title_right">
                <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search for...">
                    <span class="input-group-btn">
                      <button class="btn btn-default" type="button">Go!</button>
                    </span>
                  </div>
                </div>
              </div> -->
            </div>

            <div class="clearfix"></div>

            <div class="row">
            
              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>CDV Available Services:</h2>
<!--                     <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                        <ul class="dropdown-menu" role="menu">
                          <li><a href="#">Settings 1</a>
                          </li>
                          <li><a href="#">Settings 2</a>
                          </li>
                        </ul>
                      </li>
                      <li><a class="close-link"><i class="fa fa-close"></i></a>
                      </li>
                    </ul> -->
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                    <p class="text-muted font-13 m-b-30">
                       Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                    </p>
                    
                    <table id="datatable-buttons" class="table table-striped table-bordered">
                      <thead>
                        <tr>
                          <th>Service</th>
                          <th>Description</th>
                          <th>Info</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody>

                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
<!-- /page content -->

<!-- footer content -->
        <footer>
          <div class="pull-right">
            CDV Service Editor
          </div>
          <div class="clearfix"></div>
        </footer>
<!-- /footer content -->
      </div>
    </div>

    <!-- jQuery -->
    <script src="vendors/jquery/distrib/jquery.min.js"></script>
    
    <script src="js/preload.js"></script>
    <script>
  		//infoPDF is assigned in preload.js
		var localInfoPDF = sessionStorage.getItem("infoPDF");
		//se la variabile di sessione è già stata valorizzata...
		if(localInfoPDF){
			console.log("infoPDF valorizzato...");
			appendPDFields(localInfoPDF,1);
		}
		//sennò la si istanzia e valorizza
		else{
			getPDFields();
		}
    </script>
    
    <script>
    var services_info;
    //GET - getServices_apipath
    var url_ = "http://"+app_parameters.host_param+":"+app_parameters.port_param+"/"+app_parameters.getServices_apipath;
    console.log("composed url: "+url_);
	    $.ajax({
	        url: url_
	    }).then(function(data) {
	    	
	    	//List creation
	    	var servcontent = JSON.stringify(data);
	    	console.log(servcontent.length);
	    	
	    	var jobj = JSON.parse(servcontent);
	    	services_info = jobj;
// 	    	console.log("lUNGHEZZA DATA: "+data.length);
// 	    	console.log("lUNGHEZZA JOBJ: "+jobj.length);
	    	
// 	    	console.log(data[0].humanReadableDescription[0].description);
// 	    	console.log(data[0].humanReadableDescription);
// 	    	console.log("id0: "+data[3].publicServiceID);
// 	    	console.log(data[3]);

	    	for(i = 0; i < data.length; i++){
	    		psi = data[i].publicServiceID;
	    		$('#datatable-buttons').append("<tr id=\"info-row-"+i+"\"><td>"+data[i].publicServiceName+"</td><td>"+
	    				data[i].humanReadableDescription[0].description+
	    				"</td><td style=\"text-align: center;vertical-align: middle;\"><a href=\"#\" onclick=\"javascript:fillServiceModal("+i+")\" data-toggle=\"modal\" data-target=\".bs-example-modal-lg\"><i style=\"cursor: pointer;\" class=\"fa fa-info-circle fa-2x\"></i></a></td><td style=\"text-align: center\"><button id=\""+
	    				data[i].publicServiceID+"\" value=\""+data[i].publicServiceName+
	    				"\" class=\"btn btn-primary\" onClick=\"EditService(\'"+psi+"\')\">EDIT</button></td></tr>");
	    	}
	    
	    	//Caricamento sequenziale dei rimanenti script per garanzia funzionamento globale
	    	$.getScript("vendors/bootstrap/distrib/js/bootstrap.min.js",function() {
	    		$.getScript("vendors/fastclick/lib_dir/fastclick.js", function(){
	    			//$.getScript("vendors/nprogress/nprogress.js");
	    			$.getScript("vendors/iCheck/icheck.min.js", function(){
	    				$.getScript("vendors/datatables.net/js/jquery.dataTables.js", function(){
	    					$.getScript("vendors/datatables.net-bs/js/dataTables.bootstrap.min.js", function(){
	    						$.getScript("vendors/datatables.net-buttons/js/dataTables.buttons.min.js", function(){
	    							$.getScript("vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js", function(){
	    								$.getScript("vendors/datatables.net-buttons/js/buttons.flash.min.js", function(){
	    									$.getScript("vendors/datatables.net-buttons/js/buttons.html5.min.js", function(){
	    										$.getScript("vendors/datatables.net-buttons/js/buttons.print.min.js", function(){
	    											$.getScript("vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js", function(){
	    												$.getScript("vendors/datatables.net-keytable/js/dataTables.keyTable.min.js", function(){
	    													$.getScript("vendors/datatables.net-responsive/js/dataTables.responsive.min.js", function(){
	    														$.getScript("vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js", function(){
	    															$.getScript("vendors/datatables.net-scroller/js/dataTables.scroller.js", function(){
	    																$.getScript("vendors/jszip/distrib/jszip.min.js", function(){
	    																	//$.getScript("vendors/pdfmake/build_dir/pdfmake.min.js");
	    															    	$.getScript("vendors/pdfmake/build_dir/vfs_fonts.js", function(){
	    															    		$.getScript("js/custom.min.js");
	    															    	})
	    																})
	    															})
	    														})
	    													})
	    												})
	    											})
	    										})
	    									})
	    								})
	    							})
	    						})
	    					})
	    				})
	    			})
	    		})
	    	})
	    });
	    
	    function CreateNewService(){
	    	window.location.href = window.location.href+"edit-service.html";
	    };

	    function EditService(id){
	    	var nome = $('#'+id).attr("value").replace(" ","-");
	    	window.location.href = window.location.origin+"/service-editor/edit-service.html?"+nome+"&"+id;
	    };
	    
	    function fillServiceModal(ind){
	    	//disabling pdf modal section
	    	$('#pdf-div').hide();
	    	//enabling service modal section
	    	$('#service-div-1').show();
			$('#service-div-2').show();
	    	
	    	//flushing DOM
	    	$("#service-title").text("");	    	
	    	$("#service-description-content").text("");	    	
	    	$("#service-link-content").text("");
	    	$("#service-keyword-content").text("");
	    	$("#service-provider-content").text("");
	    	$("#service-purpose-content").text("");
	    	
	    	console.log("stampa di keywords set: ");
	    	console.log($('.keywords-set').first());
	    	$('.keywords-set').first().empty();
	    	
	    	console.log("contenuto dei servizi salvato in var globale: "+services_info[1].publicServiceName);
	    	
	    	//titolo e descrizione disponibili presso info-row-ind
// 			var titolo = $("#info-row-"+ind).children().eq(0).text();
// 	    	var descr =  $("#info-row-"+ind).children().eq(1).text();

	    	//titolo e descrizione disponibili presso jquery global var services_info
	    	var titolo = "";
	    	var descr = "";
	    	var keyword = "";
	    	var purpose = "";
	    	var provider = "";
	    	var link = "";
	    	var htmlString = "";
	    	
	    	try{
	    		var titolo = services_info[ind].publicServiceName;
	    	}catch(err){
	    		 console.log("Missing publicServiceName field, Error: "+err.message);
	    	}
	    	try{
	    		var descr = services_info[ind].humanReadableDescription[0].description;
	    	}catch(err){
	    		 console.log("Missing humanReadableDescription.description field, Error: "+err.message);
	    	}
	    	try{
	    		var keyword = services_info[ind].publicServiceKeyword;
	    	}catch(err){
	    		 console.log("Missing publicServiceKeyword field, Error: "+err.message);
	    	}
	    	try{
	    		var purpose = services_info[ind].publicServiceIsDescribedAt[0].purpose;
	    	}catch(err){
	    		 console.log("Missing publicServiceIsDescribedAt.purpose field, Error: "+err.message);
	    	}
	    	try{
	    		var provider = services_info[ind].serviceProviderId;
	    	}catch(err){
	    		 console.log("Missing serviceProviderId field, Error: "+err.message);
	    	}
	    	try{
	    		var link = services_info[ind].serviceUri;
	    	}catch(err){
	    		 console.log("Missing serviceUri field, Error: "+err.message);
	    	}
	    	
	    	console.log("titolo: "+titolo);
	    	console.log("descrizione: "+descr);
	    	console.log("provider: "+provider);
	    	console.log("purpose: "+purpose);
	    	
	    	//setting DOM
	    	$("#service-title").text(titolo);	    	
	    	$("#service-description-content").text(descr);	    	
	    	$("#service-link-content").text(link);
	    	$("#service-keyword-content").text(keyword);
	    	$("#service-provider-content").text(provider);
	    	$("#service-purpose-content").text(purpose);
	    	
	    	//console.log("prove di recapito bolle: "+services_info[ind].publicServiceIsDescribedAt[0].dataMapping.length);
	    	//console.log("valore 1: "+services_info[ind].publicServiceIsDescribedAt[0].dataMapping[0].name);
	    	//console.log("valore 2: "+services_info[ind].publicServiceIsDescribedAt[0].dataMapping[1].name);
	    	$('.keywords-set').append("<h2 id=\"service-data-title\" style=\"font-style: normal\">Data Processed: </h2>")
	    	try{
		    	var len = services_info[ind].publicServiceIsDescribedAt[0].dataMapping.length;
		    	
		    	for(i = 0; i < len; i++){
		    		htmlString += "<div><p>"+services_info[ind].publicServiceIsDescribedAt[0].dataMapping[i].name
		    				+"</p></div>";
		    	}
	    	}catch(err){
	    		console.log("Missing publicServiceIsDescribedAt.dataMapping field, Error: "+err.message);
	    	}
	    	$('.keywords-set').append(htmlString);
	    };
	    
	</script>
	<script src="vendors/pdfmake/build_dir/pdfmake.min.js"></script>

  </body>
</html>